@model IEnumerable<SIMS.Models.ViewModels.StudentScheduleViewModel>
@{
    ViewData["Title"] = "My Schedule";
}

<div class="page-header">
    <h2>
        <i class="bi bi-calendar-week"></i>
        My Schedule
    </h2>
    <p class="text-muted">View assigned courses</p>
</div>

<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label">
                    <i class="bi bi-calendar3 me-1"></i>
                    Semester
                </label>
                <select name="semester" class="form-select" onchange="this.form.submit()">
                    @foreach (var sem in ViewBag.Semesters as string[])
                    {
                        <option value="@sem" selected="@(ViewBag.Semester == sem)">@sem</option>
                    }
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">
                    <i class="bi bi-calendar-range me-1"></i>
                    Academic Year
                </label>
                <input type="text" name="academicYear" class="form-control" 
                       value="@ViewBag.AcademicYear" placeholder="2024-2025">
            </div>
            <div class="col-md-4">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-search"></i> View Schedule
                </button>
            </div>
        </form>
    </div>
</div>

@if (!Model.Any())
{
    <div class="card">
        <div class="card-body text-center py-5">
            <i class="bi bi-calendar-x text-muted" style="font-size: 4rem;"></i>
            <h4 class="mt-3 text-muted">No Courses Yet</h4>
            <p class="text-muted">
                You have not been assigned to any courses this semester.<br/>
                Please contact the training department for more details.
            </p>
        </div>
    </div>
}
else
{
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="stat-card stat-card-navy">
                <i class="bi bi-journal-check icon"></i>
                <h6>Total Courses</h6>
                <h2>@Model.Count()</h2>
                <small class="text-white d-block mt-2">Semester @ViewBag.Semester</small>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card stat-card-blue">
                <i class="bi bi-award-fill icon"></i>
                <h6>Total Credits</h6>
                <h2>@Model.Sum(m => m.Credits)</h2>
                <small class="text-white d-block mt-2">Enrolled</small>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card stat-card-green">
                <i class="bi bi-check-circle icon"></i>
                <h6>Completed</h6>
                <h2>@Model.Count(m => m.Status == "Completed")</h2>
                <small class="text-white d-block mt-2">Courses</small>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <i class="bi bi-list-ul me-2"></i>
            Course List (@ViewBag.Semester - @ViewBag.AcademicYear)
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th><i class="bi bi-book me-1"></i> Course Code</th>
                            <th>Course Name</th>
                            <th><i class="bi bi-award me-1"></i> Credits</th>
                            <th><i class="bi bi-person me-1"></i> Faculty</th>
                            <th>Status</th>
                            <th>Midterm</th>
                            <th>Final</th>
                            <th>Average</th>
                            <th>Grade</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int stt = 1;
                            foreach (var item in Model)
                            {
                                <tr>
                                    <td>@stt</td>
                                    <td><strong class="text-navy">@item.CourseCode</strong></td>
                                    <td>@item.CourseName</td>
                                    <td><span class="badge bg-info">@item.Credits</span></td>
                                    <td>@item.FacultyName</td>
                                    <td>
                                        @if (item.Status == "Active")
                                        {
                                            <span class="badge bg-success">Active</span>
                                        }
                                        else if (item.Status == "Completed")
                                        {
                                            <span class="badge bg-primary">Completed</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">Dropped</span>
                                        }
                                    </td>
                                    <td>
                                        @if (item.MidtermScore.HasValue)
                                        {
                                            <span class="text-primary">@item.MidtermScore.Value.ToString("F2")</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                    <td>
                                        @if (item.FinalScore.HasValue)
                                        {
                                            <span class="text-primary">@item.FinalScore.Value.ToString("F2")</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                    <td>
                                        @if (item.AverageScore.HasValue)
                                        {
                                            <strong class="text-success">@item.AverageScore.Value.ToString("F2")</strong>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(item.LetterGrade))
                                        {
                                            var badgeClass = item.LetterGrade.StartsWith("A") ? "bg-success" :
                                                           item.LetterGrade.StartsWith("B") ? "bg-primary" :
                                                           item.LetterGrade.StartsWith("C") ? "bg-info" :
                                                           item.LetterGrade.StartsWith("D") ? "bg-warning" : "bg-danger";
                                            <span class="badge @badgeClass">@item.LetterGrade</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                </tr>
                                stt++;
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-header bg-info text-white">
            <i class="bi bi-info-circle me-2"></i>
            Information
        </div>
        <div class="card-body">
            <ul class="mb-0">
                <li><strong>Active:</strong> Course is currently ongoing in the semester</li>
                <li><strong>Completed:</strong> Course has been completed and has grades</li>
                <li><strong>Dropped:</strong> Withdrawn from the course</li>
                <li class="mt-2 text-muted">
                    <i class="bi bi-lightbulb"></i> 
                    If you have questions about the schedule, please contact the training department
                </li>
            </ul>
        </div>
    </div>
}
