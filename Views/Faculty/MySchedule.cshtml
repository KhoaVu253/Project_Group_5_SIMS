@model SIMS.Models.ViewModels.FacultyWeeklyScheduleViewModel
@{
    ViewData["Title"] = "My Teaching Schedule";
}

<div class="page-header">
    <h2>
        <i class="bi bi-calendar-week"></i>
        Weekly Teaching Schedule
    </h2>
    <p class="text-muted">
        Faculty: <strong class="text-navy">@Model.FacultyName</strong> (@Model.FacultyCode)
    </p>
</div>

<!-- Filter -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" asp-action="MySchedule" class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Semester</label>
                <select name="semester" class="form-select">
                    @foreach (var sem in ViewBag.Semesters as string[])
                    {
                        <option value="@sem" selected="@(sem == ViewBag.Semester)">@sem</option>
                    }
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Academic Year</label>
                <input type="text" name="academicYear" class="form-control" value="@ViewBag.AcademicYear" placeholder="2024-2025" />
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-search"></i> View Schedule
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Summary Cards -->
<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card border-primary">
            <div class="card-body text-center">
                <h3 class="text-primary mb-0">@Model.TotalCourses</h3>
                <small class="text-muted">Courses Currently Teaching</small>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-success">
            <div class="card-body text-center">
                <h3 class="text-success mb-0">@Model.TotalClassesPerWeek</h3>
                <small class="text-muted">Classes Per Week</small>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-info">
            <div class="card-body text-center">
                <h3 class="text-info mb-0">@Model.Semester</h3>
                <small class="text-muted">@Model.AcademicYear</small>
            </div>
        </div>
    </div>
</div>

@if (!Model.WeekSchedule.Any(d => d.HasClass))
{
    <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        <strong>No Teaching Schedule Yet!</strong> You have not been assigned a teaching schedule for this semester.
    </div>
}
else
{
    <!-- Weekly Schedule Table -->
    <div class="card">
        <div class="card-header bg-navy text-white">
            <i class="bi bi-calendar-week me-2"></i>
            Weekly Teaching Schedule - @Model.Semester (@Model.AcademicYear)
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered schedule-table mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 12%">Period / Day</th>
                            @foreach (var day in Model.WeekSchedule)
                            {
                                <th class="text-center">
                                    <div>@day.DayAbbr</div>
                                    <small class="text-muted">@day.DayName</small>
                                </th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @for (int period = 1; period <= 12; period++)
                        {
                            <tr>
                                <td class="period-cell">
                                    <strong>Period @period</strong>
                                    <br />
                                    <small class="text-muted">
                                        @if (period <= 6)
                                        {
                                            var start = 7 + (period - 1) * 0.5;
                                            var end = start + 0.5;
                                            @($"{start:00}:{(start % 1 == 0 ? "00" : "30")} - {end:00}:{(end % 1 == 0 ? "00" : "30")}")
                                        }
                                        else
                                        {
                                            var start = 13 + (period - 7) * 0.5;
                                            var end = start + 0.5;
                                            @($"{start:00}:{(start % 1 == 0 ? "00" : "30")} - {end:00}:{(end % 1 == 0 ? "00" : "30")}")
                                        }
                                    </small>
                                </td>
                                @foreach (var day in Model.WeekSchedule)
                                {
                                    var classInPeriod = day.Classes.FirstOrDefault(c => c.StartPeriod <= period && c.EndPeriod >= period);

                                    @if (classInPeriod != null && classInPeriod.StartPeriod == period)
                                    {
                                        var rowspan = classInPeriod.EndPeriod - classInPeriod.StartPeriod + 1;
                                        <td rowspan="@rowspan" class="schedule-cell @classInPeriod.ColorClass">
                                            <div class="schedule-item">
                                                <div class="course-code">@classInPeriod.CourseCode</div>
                                                <div class="course-name">@classInPeriod.CourseName</div>
                                                <div class="schedule-details">
                                                    <i class="bi bi-clock"></i> @classInPeriod.TimeRange<br />
                                                    <i class="bi bi-door-open"></i> Room @classInPeriod.Room<br />
                                                    <i class="bi bi-mortarboard"></i> @classInPeriod.Credits Credits
                                                </div>
                                                @if (!string.IsNullOrEmpty(classInPeriod.Notes))
                                                {
                                                    <div class="schedule-notes">
                                                        <i class="bi bi-info-circle"></i> @classInPeriod.Notes
                                                    </div>
                                                }
                                            </div>
                                        </td>
                                    }
                                    else if (classInPeriod == null)
                                    {
                                        <td class="empty-cell"></td>
                                    }
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="card mt-3">
        <div class="card-body">
            <h6 class="mb-3">Legend:</h6>
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge schedule-morning" style="width: 20px; height: 20px;"></span>
                        <span>Morning (Period 1-6)</span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge schedule-afternoon" style="width: 20px; height: 20px;"></span>
                        <span>Afternoon (Period 7-12)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<style>
    .schedule-table {
        font-size: 0.9rem;
    }

    .schedule-table th {
        background-color: #f8f9fa;
        font-weight: 600;
        text-align: center;
        vertical-align: middle;
        padding: 12px 8px;
    }

    .period-cell {
        background-color: #f8f9fa;
        font-weight: 500;
        text-align: center;
        vertical-align: middle;
        padding: 8px;
    }

    .schedule-cell {
        padding: 8px !important;
        vertical-align: middle;
        position: relative;
    }

    .empty-cell {
        background-color: #fafafa;
    }

    .schedule-item {
        text-align: center;
        padding: 8px;
    }

    .course-code {
        font-weight: 700;
        font-size: 0.95rem;
        color: #1a1a1a;
        margin-bottom: 4px;
    }

    .course-name {
        font-weight: 600;
        font-size: 0.85rem;
        color: #2c3e50;
        margin-bottom: 6px;
    }

    .schedule-details {
        font-size: 0.8rem;
        color: #555;
        line-height: 1.6;
    }

    .schedule-details i {
        margin-right: 3px;
    }

    .schedule-notes {
        margin-top: 6px;
        padding-top: 6px;
        border-top: 1px dashed rgba(0,0,0,0.1);
        font-size: 0.75rem;
        font-style: italic;
        color: #666;
    }

    /* Color coding for sessions */
    .schedule-morning {
        background-color: #e3f2fd !important;
        border-left: 4px solid #2196F3;
    }

    .schedule-afternoon {
        background-color: #fff3e0 !important;
        border-left: 4px solid #FF9800;
    }

    .page-header h2 {
        color: #2c3e50;
        margin-bottom: 0.5rem;
    }

    .bg-navy {
        background-color: #2c3e50 !important;
    }

    .text-navy {
        color: #2c3e50 !important;
    }
</style>

@section Scripts {
    <script>
        // Auto-submit form when semester/year changes
        document.querySelectorAll('select[name="semester"]').forEach(function(select) {
            select.addEventListener('change', function() {
                this.form.submit();
            });
        });
    </script>
}
